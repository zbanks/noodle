<!doctype html>
<html>
    <head>
        <title>Noodle</title>
        <style>
            body {
            }
            textarea {
                width: min(600px, 90%);
                height: 300px;
                font-family: Monospace;
                font-size: 1.4rem;
            }
            #output {
                font-family: Monospace;
                font-size: 1.2rem;
                white-space: pre-wrap;
            }
            .column-container {
                display: flex;
                flex-flow: row wrap;
            }
            .column {
                width: max(30%, 300px);
                margin: 10px;
            }
            .examples {
                margin-top: 40px;
            }
            a.example {
                font-family: Monospace;
                color: black;
                text-decoration: none;
            }
            a.example:hover {
                text-decoration: underline;
            }
        </style>
    </head>
    <body>
        <h1><a href="https://github.com/zbanks/noodle">Noodle</a></h1>
        <div class="column-container">
            <div class="column">
                <h2>Input</h2>
                <textarea id="input"></textarea>
                <div>
                    <button id="query">Query</button>
                    <button id="stop">Stop</button>
                </div>
                <div class="examples">
                    <h2>Examples</h2>
                    <ul>
                        <li><a class="example">helloworld</a></li>
                        <li><a class="example">_h...._w...._; &lt;hello+&gt;; &lt;world+5&gt;; [hale]+&lt;owl&gt;.*</a></li>
                        <li><a class="example">&lt;smiles&gt;</a></li>
                        <li><a class="example">&lt;smiles&gt;; .*ss.*</a></li>
                        <li><a class="example">ahumongoussentenceofmultiplewords</a></li>
                        <li><a class="example">3 3 8 7; (LOOHNEWHOOPCRLOVAIDYTILEAUQWOSLLPEASSOEHNCS:?) !'</a></li>
                        <!-- <li><a class="example">nx 2: breadfast</a></li> -->
                    </ul>
                </div>
            </div>
            <div class="column">
                <h2>Output</h2>
                <div id="output">
                </div>
            </div>
            <div class="column">
                <h2>Help</h2>
<!-- generated from `pandoc help.md` -->

<p>Specify filters in the input textbox. Each line is treated as a <em>noodle expression</em>.</p>
<p>The query runs until the input wordlist is exhausted, 300 results are returned, or 15 seconds have passed.</p>
<!-- If `N` is provided, perform a fuzzy match with up to `N` edits. (NB: consecutive inserts are not allowed) -->

<p>Noodle supports the following regex syntax: <code>[...]</code>, <code>[^...]</code>, <code>.</code>, <code>*</code>, <code>+</code>, <code>?</code>, <code>(...)</code>, <code>|</code>, <code>{...}</code>.</p>
<p>Before matching, words are converted to lowercase and stripped of whitespace and non-alphabetical symbols (punctuation, numbers).</p>
<p>To explicitly match spaces, include &quot;<code>!_</code>&quot; at the end of the expression. When enabled, the matched phrase is surrounded by spaces, and space characters can be explicitly matched with the &quot;<code>_</code>&quot; character.</p>
<p>To explicitly match other symbols, include &quot;<code>!'</code>&quot; at the end of the expression. When enabled, these symbols can be matched with the &quot;<code>'</code>&quot; character.</p>
<p>Regardless of setting, and unlike normal regular expressions, the period (&quot;<code>.</code>&quot;) is only equivalent to &quot;<code>[a-z]</code>&quot;. To match <em>any</em> symbol, use &quot;<code>[a-z'_]</code>&quot;.</p>
<p>Noodle has additional support for anagram-like constriants with angle bracket syntax: <code>&lt;...&gt;</code></p>
<ul class="incremental">
<li><code>&lt;abcd&gt;</code> -- <strong>anagram</strong> of <code>abcd</code>: rearranging the given letters</li>
<li><code>&lt;abcd+&gt;</code> -- <strong>superanagram</strong> of <code>abcd</code>: rearranging <em>at least</em> the given letters</li>
<li><code>&lt;abcd+3&gt;</code> -- <strong>transadd</strong> of <code>3</code> to <code>abcd</code>: rearranging <em>all</em> of the given letters <em>plus</em> <code>N</code> wildcards</li>
<li><code>&lt;abcd-&gt;</code> -- <strong>subanagram</strong> of <code>abcd</code>: rearranging <em>at most</em> the given letters</li>
<li><code>&lt;abcd-1&gt;</code> -- <strong>transdelete</strong> of <code>3</code> to <code>abcd</code>: rerranging <em>all but <code>N</code></em> of the given letters</li>
<li><code>(abcd:?)</code> -- <strong>partial</strong> of <code>abcd</code>: contained within a subset of the given letters, in the same order</li>
</ul>
<!--
TODO:
- `<abcd:~>` -- **bank**
- `<abcd:+>` -- **superbank**
- `<abcd:->` -- **subbank**
- `(abcd:+2)` -- **add**
- `(abcd:-2)` -- **delete**
- `(abcd:~2)` -- **change**
- `(abcd:~)` -- **substring**
-->

<!-- end help -->
            </div>
        </div>
        <script type="text/javascript">
            function stop() {
                if (window.req) {
                    console.log("aborting xhr", window.req);
                    window.req.abort();
                    window.req = null;
                }
            }
            function processResponse(text) {
                if (!text) {
                    return "";
                }
                output = "";
                header = [];
                var lines = text.split("\n");
                for (var i = 0; i < lines.length; i++) {
                    var line = lines[i];
                    if (line[0] == "#") {
                        header[+line[1]] = line.slice(3);
                    } else {
                        output += line + "\n";
                    }
                }
                return header.join("\n") + "\n" + output;
            }
            var input = document.querySelector("#input");
            function submit() {
                stop();
                var inputText = input.value;
                var req = new XMLHttpRequest();
                var updateOutput = function() {
                    document.querySelector("#output").innerText = processResponse(this.responseText);
                };
                updateOutput();
                req.addEventListener("load", updateOutput);
                req.addEventListener("loadstart", updateOutput);
                req.addEventListener("progress", updateOutput);
                req.addEventListener("error", function() {
                    var div = document.querySelector("#output");
                    div.innerText = "No response from server" + "\n\n" + div.innerText;
                });
                req.open("POST", "/");
                req.setRequestHeader("Content-Type", "text/plain");
                req.send(inputText);
                window.req = req;
            }
            document.querySelector("#stop").addEventListener("click", stop);
            document.querySelector("#query").addEventListener("click", submit);
            document.querySelector("#input").addEventListener("keydown", function (e) {
                if (e.keyCode == 13 && e.ctrlKey) {
                    submit();
                }
            });
            document.querySelectorAll("a.example").forEach(function(a) {
                a.href = "#";
                a.addEventListener("click", function() {
                    input.value = a.innerText.replace(/; /g, "\n");
                    submit();
                });
            });
        </script>
    </body>
</html>
