<!doctype html>
<html>
    <head>
        <title>Noodle</title>
        <style>
            body {
            }
            textarea {
                width: min(600px, 90%);
                height: 300px;
                font-family: Monospace;
                font-size: 1.4rem;
            }
            #output {
                font-family: Monospace;
                font-size: 1.2rem;
                white-space: pre-wrap;
            }
            .column-container {
                display: flex;
                flex-flow: row wrap;
            }
            .column {
                width: max(30%, 300px);
                margin: 10px;
            }
            .examples {
                margin-top: 40px;
            }
            a.example {
                font-family: Monospace;
                color: black;
                text-decoration: none;
            }
            a.example:hover {
                text-decoration: underline;
            }
        </style>
    </head>
    <body>
        <h1><a href="https://github.com/zbanks/noodle">Noodle</a></h1>
        <div class="column-container">
            <div class="column">
                <h2>Input</h2>
                <textarea id="input"></textarea>
                <div>
                    <button id="query">Query</button>
                    <button id="stop">Stop</button>
                </div>
                <div class="examples">
                    <h2>Examples</h2>
                    <ul>
                        <li><a class="example">nxn 4: happybirthdaytoyou</a></li>
                        <li><a class="example">anagram: smiles</a></li>
                        <li><a class="example">anagram: smiles; .*ss.*</a></li>
                        <li><a class="example">nx 2: breadfast</a></li>
                    </ul>
                </div>
            </div>
            <div class="column">
                <h2>Output</h2>
                <div id="output">
                </div>
            </div>
            <div class="column">
                <h2>Help</h2>
<!-- generated from `pandoc help.md` -->
<p>Specify filters in the input textbox. Each line is treated as a filter.</p>
<p>The filters are &quot;chained&quot; together, in order. The output pane shows which words matched the entire filter chain.</p>
<p>The query runs until the input wordlist is exhausted, 300 results are returned, or 15 seconds have past.</p>
<h4><code>nx [N]: &lt;noodlex&gt;</code></h4>
<p>Evalute noodle expression</p>
<p>If <code>N</code> is provided, perform a fuzzy match with up to <code>N</code> edits. (NB: consecutive inserts are not allowed)</p>
<p>Supported regex features: <code>[...]</code>, <code>[^...]</code>, <code>.</code>, <code>*</code>, <code>+</code>, <code>?</code>, <code>(...)</code>, <code>|</code>.</p>
<p>Matches are case-insentive. Spaces are ignored both in the expression, and the matched word. An <code>_</code> in the expression matches an space character in a word.</p>
<h4><code>nxn N: &lt;noodlex&gt;</code></h4>
<p>Evalute noodle expression, matching up to <code>N</code> words.</p>
<p>The <code>noodlex</code> expression follows the same syntax as the <code>nx</code> command, except multi-word search cannot be combined with fuzzy search.</p>
<p><strong>Note:</strong> This is handled as a special case for now, and cannot be chained with any other filters.</p>
<h4><code>regex: &lt;regex&gt;</code></h4>
<p>Evaluate regular expression. Matches are case-insentive. The whole word must match, it is implicitly wrapped in <code>^...$</code>.</p>
<h4><code>extract: &lt;regex&gt;</code></h4>
<p>Evalulate regular expression, but return the first capture group (it must also be a word)</p>
<h4><code>extractq: &lt;regex&gt;</code></h4>
<p>Evalulate regular expression, but return the first capture group (it does not have to be a word)</p>
<h4><code>anagram: &lt;letters&gt;</code></h4>
<p>Anagram</p>
<h4><code>subanagram: &lt;letters&gt;</code></h4>
<p>Contains at most the given letters</p>
<h4><code>superanagram: &lt;letters&gt;</code></h4>
<p>Contains at least the given letters</p>
<h4><code>transadd N: &lt;letters&gt;</code></h4>
<p>Contains the given letters, plus <code>N</code> extras</p>
<h4><code>transdelete N: &lt;letters&gt;</code></h4>
<p>Contains the given letters, except <code>N</code> of them</p>
<h4><code>bank: &lt;letters&gt;</code></h4>
<p>Only contains the given letters (but with repeats)</p>
<h4><code>score N:</code></h4>
<p>The word's <em>score</em> is at least <code>N</code>. The score is a value hard-coded in the wordlist: common words have high scores, &quot;less real&quot; words have low scores.</p>
<!-- end help -->
            </div>
        </div>
        <script type="text/javascript">
            function stop() {
                if (window.req) {
                    console.log("aborting xhr", window.req);
                    window.req.abort();
                    window.req = null;
                }
            }
            function processResponse(text) {
                if (!text) {
                    return "";
                }
                output = "";
                header = [];
                var lines = text.split("\n");
                for (var i = 0; i < lines.length; i++) {
                    var line = lines[i];
                    if (line[0] == "#") {
                        header[+line[1]] = line.slice(3);
                    } else {
                        output += line + "\n";
                    }
                }
                return header.join("\n") + "\n" + output;
            }
            var input = document.querySelector("#input");
            function submit() {
                stop();
                var inputText = input.value;
                var req = new XMLHttpRequest();
                var updateOutput = function() {
                    document.querySelector("#output").innerText = processResponse(this.responseText);
                };
                updateOutput();
                req.addEventListener("load", updateOutput);
                req.addEventListener("loadstart", updateOutput);
                req.addEventListener("progress", updateOutput);
                req.addEventListener("error", function() {
                    var div = document.querySelector("#output");
                    div.innerText = "No response from server" + "\n\n" + div.innerText;
                });
                req.open("POST", "/");
                req.setRequestHeader("Content-Type", "text/plain");
                req.send(inputText);
                window.req = req;
            }
            document.querySelector("#stop").addEventListener("click", stop);
            document.querySelector("#query").addEventListener("click", submit);
            document.querySelector("#input").addEventListener("keydown", function (e) {
                if (e.keyCode == 13 && e.ctrlKey) {
                    submit();
                }
            });
            document.querySelectorAll("a.example").forEach(function(a) {
                a.href = "#";
                a.addEventListener("click", function() {
                    input.value = a.innerText.replace("; ", "\n");
                    submit();
                });
            });
        </script>
    </body>
</html>
